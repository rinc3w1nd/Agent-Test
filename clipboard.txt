# edge_probe.py
import asyncio, json, os
from playwright.async_api import async_playwright

CFG = {
    "browser_channel": "msedge",
    "headless": False,
    "edge_user_data_dir": "/Users/<you>/Library/Application Support/Microsoft Edge",
    "edge_profile_directory": "Profile 6",
    # "strict_persistent": True,  # uncomment to fail fast
}

from pathlib import Path
def expand(p): return os.path.expandvars(os.path.expanduser(p))
def resolve(cfg):
    ud = expand(CFG["edge_user_data_dir"])
    prof = CFG.get("edge_profile_directory","")
    p = Path(ud)
    tail = p.name.lower()
    is_profile = (tail=="default") or tail.startswith("profile ")
    if prof:
        if is_profile and tail != prof.lower():
            p = p.parent / prof
        elif not is_profile:
            p = p / prof
    return str(p)

async def main():
    eff = resolve(CFG)
    print("EFF:", eff, "exists:", os.path.isdir(eff))
    try:
        with open(os.path.join(eff,"Preferences"), "r") as pf:
            prefs = json.load(pf)
        print("Profile name:", (prefs.get("profile") or {}).get("name"))
    except Exception as e:
        print("No Preferences:", e)

    async with async_playwright() as pw:
        ctx = await pw.chromium.launch_persistent_context(
            user_data_dir=eff, channel=CFG["browser_channel"], headless=CFG["headless"]
        )
        print("Launched. Pages:", len(ctx.pages))
        await ctx.close()

asyncio.run(main())